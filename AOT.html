<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Google Sheet</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 30px;
      background: #f5f5f5;
      color: #333;
    }
    h2, h3 {
      text-align: center;
      color: #0a3d62;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      background-color: #0a3d62;
      color: white;
      border: none;
      padding: 12px 20px;
      margin-top: 15px;
      cursor: pointer;
      border-radius: 8px;
      font-size: 16px;
    }
    button:hover {
      background-color: #3c6382;
    }
    .menu {
      text-align: center;
      margin-bottom: 20px;
    }
    .menu button {
      padding: 10px 20px;
      margin: 0 5px;
      font-size: 16px;
    }
    .form-section {
      display: none;
    }
    .action-buttons {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    .action-buttons button {
      margin-left: 5px;
      background-color: #ccc;
      color: black;
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <div style="text-align: center;">
    <img src="Img/LOGOTHEGREAT.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" style="width: 120px; margin-bottom: 10px;">
  </div>

  <h2>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>

  <div class="menu">
    <button onclick="showSection('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <button onclick="showSection('search')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button onclick="showSection('add')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <div id="searchSection" class="form-section">
    <h3>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
    <input type="text" id="searchName" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠...">
    <input type="text" id="searchPhone" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£...">
    <input type="text" id="searchProvince" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...">
    <button onclick="searchCustomer()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  </div>

  <div id="addSection" class="form-section">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
    <form id="customerForm" class="card">
      <input type="hidden" name="row" id="row">
      <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" name="date" id="date">
      <label>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤</label>
      <select name="source" id="source">
        <option>Walk In ‡∏™‡∏≤‡∏Ç‡∏≤ 1</option>
        <option>Walk In ‡∏™‡∏≤‡∏Ç‡∏≤ 2</option>
        <option>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ô‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤</option>
        <option>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
        <option>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏à‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</option>
      </select>
      <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" name="name" id="name">
      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ / Line</label><input type="text" name="phone" id="phone">
      <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label><input type="text" name="province" id="province">
      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏ñ</label><input type="text" name="car" id="car">
      <label>Cash/FN</label>
      <select name="cashfn" id="cashfn">
        <option>‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå</option>
        <option>‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏î</option>
      </select>
      <label>Status</label>
      <select name="status" id="status">
        <option>Booking</option>
        <option>Hot</option>
        <option>Approve</option>
        <option>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
      </select>
      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
      <textarea name="followup" id="followup" rows="3"></textarea>
      <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>
  </div>

  <h3>üìÑ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
  <div id="customerList"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbw5CJfoUjcIhJMTidIjQKL0_YbTjg9hD-U7zWAD9bHXG_P0nlCReokvxLnRwLqct9YYGA/exec";
    let allCustomers = [];

    function showSection(section) {
      document.getElementById('searchSection').style.display = section === 'search' ? 'block' : 'none';
      document.getElementById('addSection').style.display = section === 'add' ? 'block' : 'none';
      if (section === 'home') {
        loadCustomers();
      }
    }

    function loadCustomers() {
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          allCustomers = data;
          displayCustomers(data);
        });
    }

    function displayCustomers(data) {
      const list = document.getElementById("customerList");
      list.innerHTML = "";
      data.forEach(c => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <div class="action-buttons">
            <button onclick='editCustomer(${JSON.stringify(c)})'>‚úèÔ∏è</button>
            <button onclick='deleteCustomer(${c.row})'>üóë</button>
          </div>
          <b>üë§ ${c.name}</b> | ${c.phone}<br>
          üöó ${c.car}<br>
          üìÜ ${c.date} | ‡∏à.${c.province}<br>
          ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤: ${c.source}<br>
          üí∞ ${c.cashfn} | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${c.status}<br>
          üìå ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: ${c.followup}
        `;
        list.appendChild(div);
      });
    }

    function editCustomer(data) {
      showSection('add');
      for (const key in data) {
        if (document.getElementById(key)) {
          document.getElementById(key).value = data[key];
        }
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteCustomer(row) {
      if (confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ row, delete: true })
        }).then(() => {
          alert("üóë ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          loadCustomers();
        });
      }
    }

    document.getElementById("customerForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(this));
      fetch(scriptURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      })
      .then(() => {
        alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        this.reset();
        document.getElementById("row").value = "";
        loadCustomers();
        showSection('home');
      });
    });

    function searchCustomer() {
      const name = document.getElementById("searchName").value.toLowerCase();
      const phone = document.getElementById("searchPhone").value.toLowerCase();
      const province = document.getElementById("searchProvince").value.toLowerCase();
      const filtered = allCustomers.filter(c =>
        (!name || c.name.toLowerCase().includes(name)) &&
        (!phone || c.phone.toLowerCase().includes(phone)) &&
        (!province || c.province.toLowerCase().includes(province))
      );
      displayCustomers(filtered);
    }

    loadCustomers();
    showSection('home');
  </script>

</body>
</html>
